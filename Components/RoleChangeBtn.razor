@using LanguageLearning.Data
@using Microsoft.AspNetCore.Identity
@inject AuthenticationStateProvider AuthState
@inject RoleManager<IdentityRole> RoleManager
@inject UserManager<LanguageLearningUser> UserManager
@inject NavigationManager Navigation
@rendermode InteractiveServer


<button @onclick="ChangeToPremium" class="btn btn-primary">Make Me Admin</button>

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert alert-info mt-3">@message</div>
}

@code {
    private string message = "";

    private async Task ChangeToPremium()
    {
        try
        {
            var authState = await AuthState.GetAuthenticationStateAsync();
            var user = await UserManager.GetUserAsync(authState.User);

            if (user != null)
            {
                // Remove from User role
                if (await UserManager.IsInRoleAsync(user, "User"))
                {
                    await UserManager.RemoveFromRoleAsync(user, "User");
                }
                //Remove from Admin role
                if (await UserManager.IsInRoleAsync(user, "Administrator"))
                {
                    await UserManager.RemoveFromRoleAsync(user, "Administrator");
                }

                // Add to Administrator role
                if (!await UserManager.IsInRoleAsync(user, "Premium"))
                {
                    var result = await UserManager.AddToRoleAsync(user, "Premium");
                }
                else
                {
                    message = "You are already a Premium user!";
                }
            }
            else
            {
                message = "User not found!";
            }
        }
        catch (Exception ex)
        {
            message = $"Error: {ex.Message}";
        }
    }
}
